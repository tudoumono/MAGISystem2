# MAGI Decision System - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## ğŸ“š å‚è€ƒè¨˜äº‹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®è¨˜äº‹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’**å®Œå…¨æº–æ‹ **ã§å®Ÿè£…ã—ã¾ã™ï¼š

**[Amplify Hostingã§Bedrock AgentCoreã‚’ä½¿ã†](https://qiita.com/moritalous/items/ea695f8a328585e1313b)**

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

âš ï¸ **é‡è¦ãªæ³¨æ„äº‹é …**: 
- AgentCore Runtimeã¯**1ã¤ã®Dockerã‚³ãƒ³ãƒ†ãƒŠ**ã§ã™
- Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨Pythonã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯**åŒã˜ã‚³ãƒ³ãƒ†ãƒŠå†…**ã§å‹•ä½œã—ã¾ã™
- Next.jsãŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã€Pythonã‚’**å­ãƒ—ãƒ­ã‚»ã‚¹**ã¨ã—ã¦å‘¼ã³å‡ºã—ã¾ã™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Amplify Hosting                              â”‚
â”‚  Next.js Frontend (æ—¢å­˜)                                     â”‚
â”‚  â”œâ”€ Chat Interface (useChat)                                â”‚
â”‚  â”œâ”€ Agent Response Panels                                   â”‚
â”‚  â”œâ”€ SOLOMON Judge Display                                   â”‚
â”‚  â”œâ”€ Trace Visualization                                     â”‚
â”‚  â”œâ”€ Auth (Cognito)                                          â”‚
â”‚  â””â”€ Data (DynamoDB + GraphQL)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ useChat() â†’ /invocations
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Bedrock AgentCore Runtime (1ã¤ã®Dockerã‚³ãƒ³ãƒ†ãƒŠ)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Next.js Backend (æ–°è¦ä½œæˆ)                           â”‚  â”‚
â”‚  â”‚  - ãƒãƒ¼ãƒˆ8080ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡                      â”‚  â”‚
â”‚  â”‚  - POST /invocations                                  â”‚  â”‚
â”‚  â”‚  - GET /ping                                          â”‚  â”‚
â”‚  â”‚  â†“ spawn('python', ['magi_agent.py'])                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Python Agents (æ—¢å­˜)                                 â”‚  â”‚
â”‚  â”‚  - åŒä¸€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œ                â”‚  â”‚
â”‚  â”‚  - magi_agent.py                                      â”‚  â”‚
â”‚  â”‚  - Strands Agents 1.0                                 â”‚  â”‚
â”‚  â”‚  - CASPAR / BALTHASAR / MELCHIOR / SOLOMON           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  Dockerfile: python:3.11-slim + Node.js                     â”‚
â”‚  CMD: npm start (Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ InvokeModel
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Amazon Bedrock API                              â”‚
â”‚  - Claude 3.5 Sonnet                                         â”‚
â”‚  - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ è¨­è¨ˆåˆ¤æ–­

### ãªãœã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸æŠã—ãŸã‹

1. **Amplify Hostingã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°åˆ¶é™ã‚’å›é¿**
   - Amplify Hostingã¯Server-Sent Eventsã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«å¯¾å¿œã—ã¦ã„ãªã„
   - AgentCore Runtimeå†…ã§Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å‹•ã‹ã™ã“ã¨ã§åˆ¶é™ã‚’å›é¿

2. **å®Ÿè¨¼æ¸ˆã¿ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**
   - å‚è€ƒè¨˜äº‹ã§å‹•ä½œç¢ºèªæ¸ˆã¿
   - å®‰å®šæ€§ã¨ä¿¡é ¼æ€§ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹

3. **æ—¢å­˜è³‡ç”£ã®æ´»ç”¨**
   - Pythonå®Ÿè£…ï¼ˆStrands Agentsï¼‰ã‚’ãã®ã¾ã¾æ´»ç”¨
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.jsï¼‰ã‚‚ãã®ã¾ã¾æ´»ç”¨
   - ç„¡é§„ãªå†å®Ÿè£…ã‚’é¿ã‘ã‚‹

4. **ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ**
   - Lambda Response Streamingãªã©ã®è¤‡é›‘ãªè¨­å®šä¸è¦
   - ä¿å®ˆã—ã‚„ã™ã„

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“

```
MAGISystem2/
â”œâ”€â”€ src/                          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆAmplify Hostingï¼‰
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ dashboard/           # ãƒ¡ã‚¤ãƒ³UI
â”‚   â”‚   â””â”€â”€ api/                 # ä½¿ç”¨ã—ãªã„ï¼ˆå‰Šé™¤äºˆå®šï¼‰
â”‚   â”œâ”€â”€ components/
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useMAGIChat.ts       # useChat()çµ±åˆ
â”œâ”€â”€ agents/                       # AgentCore Runtimeï¼ˆ1ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠï¼‰
â”‚   â”œâ”€â”€ backend/                 # æ–°è¦ä½œæˆ: Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚   â”‚       â”œâ”€â”€ invocations/route.ts
â”‚   â”‚   â”‚       â””â”€â”€ ping/route.ts
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â””â”€â”€ python-bridge.ts
â”‚   â”œâ”€â”€ magi_agent.py            # æ—¢å­˜: Pythonã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile               # Next.js + Pythonçµ±åˆ
â””â”€â”€ amplify/                      # Amplifyè¨­å®š
    â”œâ”€â”€ auth/
    â””â”€â”€ data/
```

### AgentCore Runtimeã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ï¼ˆagents/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

âš ï¸ **é‡è¦**: ã“ã‚Œã‚‰ã¯å…¨ã¦**1ã¤ã®Dockerã‚³ãƒ³ãƒ†ãƒŠå†…**ã«å«ã¾ã‚Œã¾ã™

```
agents/ (Dockerã‚³ãƒ³ãƒ†ãƒŠå†…)
â”œâ”€â”€ backend/                     # Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ .next/                  # ãƒ“ãƒ«ãƒ‰æ¸ˆã¿Next.js
â”‚   â”œâ”€â”€ node_modules/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ magi_agent.py                # Pythonã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ types.py
â”‚   â””â”€â”€ prompts.py
â”œâ”€â”€ venv/                        # Pythonä»®æƒ³ç’°å¢ƒ
â””â”€â”€ requirements.txt

å®Ÿè¡Œæ™‚:
- Next.jsãŒãƒãƒ¼ãƒˆ8080ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
- Next.jsãŒPythonã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦èµ·å‹•
- ä¸¡æ–¹ãŒåŒã˜ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å‹•ä½œ
```

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆAmplify Hostingï¼‰
- **Next.js 15** + **React 19** + **TypeScript**
- **Tailwind CSS**
- **Vercel AI SDK** (`useChat`)
- **Amplify Auth** (Cognito)
- **Amplify Data** (DynamoDB + GraphQL)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAgentCore Runtimeï¼‰
- **Next.js** (TypeScript) - API Routes
- **Python 3.11+** - Strands Agents
- **Strands Agents 1.0** - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Amazon Bedrock** - LLMãƒ¢ãƒ‡ãƒ«

## ğŸš€ é€šä¿¡ãƒ•ãƒ­ãƒ¼

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³ªå•ã‚’å…¥åŠ›

```typescript
// src/hooks/useMAGIChat.ts
import { useChat } from 'ai/react';

export function useMAGIChat() {
  return useChat({
    api: process.env.NEXT_PUBLIC_AGENTCORE_URL + '/invocations'
  });
}
```

### 2. AgentCore Runtimeï¼ˆNext.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ãŒå—ä¿¡

âš ï¸ **é‡è¦**: Next.jsã¨Pythonã¯**åŒã˜ã‚³ãƒ³ãƒ†ãƒŠå†…**ã§å‹•ä½œã—ã¾ã™

```typescript
// agents/backend/app/api/invocations/route.ts
import { spawn } from 'child_process';

export async function POST(request: Request) {
  const { messages } = await request.json();
  
  // åŒã˜ã‚³ãƒ³ãƒ†ãƒŠå†…ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å‘¼ã³å‡ºã—
  const pythonProcess = spawn('python', [
    '/app/magi_agent.py',  // ã‚³ãƒ³ãƒ†ãƒŠå†…ã®çµ¶å¯¾ãƒ‘ã‚¹
    '--question', messages[messages.length - 1].content
  ]);
  
  // Pythonã®æ¨™æº–å‡ºåŠ›ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è»¢é€
  return new Response(pythonProcess.stdout, {
    headers: { 'Content-Type': 'text/event-stream' }
  });
}
```

### 3. Python magi_agent.pyãŒå‡¦ç†

```python
# agents/magi_agent.py
async def process_decision(question: str):
    # 3è³¢è€…ä¸¦åˆ—å®Ÿè¡Œ
    results = await asyncio.gather(
        caspar_agent.analyze(question),
        balthasar_agent.analyze(question),
        melchior_agent.analyze(question)
    )
    
    # SOLOMON Judgeçµ±åˆ
    final_decision = await solomon_judge.evaluate(results)
    
    return final_decision
```

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### å®Ÿè£…çŠ¶æ³ï¼ˆ2025-11-09æ›´æ–°ï¼‰

âœ… **å‚è€ƒè¨˜äº‹å®Œå…¨æº–æ‹ ã®å®Ÿè£…å®Œäº†**
- `agents/backend/` - Next.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…æ¸ˆã¿
- `agents/Dockerfile` - Next.js + Pythonçµ±åˆã‚³ãƒ³ãƒ†ãƒŠå®Œæˆ
- `POST /api/invocations` - spawn()ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…æ¸ˆã¿
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - AgentCore Runtimeç›´æ¥å‘¼ã³å‡ºã—ã«ä¿®æ­£æ¸ˆã¿

âš ï¸ **PR #5ã§èª¤ã£ã¦å®Ÿè£…ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆéæ¨å¥¨ï¼‰**
- `src/app/api/magi/stream/route.ts` - AWS SDKä½¿ç”¨ï¼ˆå‚è€ƒè¨˜äº‹ã¨ç•°ãªã‚‹ï¼‰
- ã“ã‚Œã‚‰ã¯å­¦ç¿’ç›®çš„ã®ãŸã‚æ®‹ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„

### ä½¿ç”¨ã—ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³

ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯**ä½¿ç”¨ã—ã¾ã›ã‚“**ï¼š

âŒ **AWS SDKçµŒç”±ã®AgentCore Runtimeå‘¼ã³å‡ºã—**
- PR #5ã§èª¤ã£ã¦å®Ÿè£…ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³
- å‚è€ƒè¨˜äº‹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ç•°ãªã‚‹
- `BedrockAgentCoreClient` ã‚’ä½¿ç”¨ã—ãªã„

âŒ **Lambda Response Streaming**
- è¤‡é›‘ã§æœªå®Ÿè¨¼
- Amplify Gen2ã§ã®è¨­å®šãŒå›°é›£

âŒ **Amplify defineFunction()**
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«å¯¾å¿œã—ã¦ã„ãªã„
- å‚è€ƒè¨˜äº‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç•°ãªã‚‹

### æ¡ç”¨ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

âœ… **å‚è€ƒè¨˜äº‹å®Œå…¨æº–æ‹ ï¼ˆå®Ÿè£…å®Œäº†ï¼‰**
- AgentCore Runtimeå†…ã§Next.jsã¨Pythonã‚’çµ±åˆ
- spawn()ã§å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å‘¼ã³å‡ºã—
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ç›´æ¥ /api/invocations ã‚’å‘¼ã³å‡ºã—
- ã‚·ãƒ³ãƒ—ãƒ«ã§ä¿å®ˆã—ã‚„ã™ã„
- æ—¢å­˜è³‡ç”£ã‚’æ´»ç”¨

## ğŸ“š å‚è€ƒè³‡æ–™

- [å‚è€ƒè¨˜äº‹: Amplify Hostingã§Bedrock AgentCoreã‚’ä½¿ã†](https://qiita.com/moritalous/items/ea695f8a328585e1313b)
- [Strands Agentså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://strandsagents.com/latest/)
- [Vercel AI SDK](https://sdk.vercel.ai/docs)
- [Amazon Bedrock](https://aws.amazon.com/bedrock/)
