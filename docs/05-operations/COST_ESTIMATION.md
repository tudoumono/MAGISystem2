# MAGIシステム 費用見積もり書

## 概要

MAGIシステム（エヴァンゲリオン風多視点分析システム）の個人開発レベルでの月間運用費用を詳細に見積もりました。

## 前提条件

- **利用規模**: 個人開発レベル
- **月間利用**: 100回のMAGI分析（1日3-4回程度）
- **1回の分析**: 平均30秒実行時間
- **データ保存**: 会話履歴500件程度
- **地域**: AWS ap-northeast-1（東京リージョン）

## システム構成

⚠️ **注意**: この費用見積もりは古いアーキテクチャに基づいています。
現在のアーキテクチャは[docs/ARCHITECTURE.md](./ARCHITECTURE.md)を参照してください。

```
ユーザー → Amplify Hosting (Next.js Frontend)
                ↓ useChat() → /invocations
         AgentCore Runtime (1つのDockerコンテナ)
         ├─ Next.jsバックエンド（ポート8080）
         └─ Python magi_agent.py（子プロセス）
                ↓
         Bedrock (Claude 3) × 4回
         (CASPAR + BALTHASAR + MELCHIOR + SOLOMON)
                ↓
         DynamoDB ← AppSync ← リアルタイム更新
```

## 詳細費用見積もり

### 1. Amazon Bedrock（主要コスト）

**Claude 3 Sonnet使用料**

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| 入力トークン | 1,000トークン/回 × 4エージェント × 100回 | 400,000トークン | $3.00/1Mトークン | $1.20 |
| 出力トークン | 500トークン/回 × 4エージェント × 100回 | 200,000トークン | $15.00/1Mトークン | $3.00 |
| **小計** | | | | **$4.20 (630円)** |

### 2. Amazon Bedrock AgentCore Runtime

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| 実行時間 | 30秒/回 × 100回 | 0.83時間 | $0.10/時間 | $0.08 |
| **小計** | | | | **$0.08 (12円)** |

### 3. AWS Amplify

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| ホスティング | Next.jsアプリ | 無料枠内 | 無料枠: 1,000ビルド分/月 | $0 |
| データ転送 | CDN配信 | 無料枠内 | 無料枠: 15GB/月 | $0 |
| **小計** | | | | **$0** |

### 4. Amazon DynamoDB

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| ストレージ | 会話履歴 500件 × 5KB | 2.5MB | 無料枠: 25GB/月 | $0 |
| 読み取り | 会話履歴取得 | 1,000回 | 無料枠: 25万回/月 | $0 |
| 書き込み | 新規会話保存 | 100回 | 無料枠: 25万回/月 | $0 |
| **小計** | | | | **$0** |

### 5. Amazon S3

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| ストレージ | 静的ファイル | 100MB | 無料枠: 5GB/月 | $0 |
| GETリクエスト | ファイル取得 | 1,000回 | 無料枠: 2万回/月 | $0 |
| PUTリクエスト | ファイルアップロード | 100回 | 無料枠: 2,000回/月 | $0 |
| **小計** | | | | **$0** |

### 6. Amazon CloudFront

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| データ転送 | CDN配信 | 1GB | 無料枠: 1TB/月 | $0 |
| HTTPSリクエスト | API呼び出し | 10,000回 | 無料枠: 1,000万回/月 | $0 |
| **小計** | | | | **$0** |

### 7. Amazon API Gateway

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| REST API | MAGI分析API | 1,000回 | 無料枠: 100万回/月 | $0 |
| **小計** | | | | **$0** |

### 8. AWS Lambda

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| 実行時間 | ストリーミング制御 | 500秒 | 無料枠: 100万秒/月 | $0 |
| リクエスト | 関数呼び出し | 100回 | 無料枠: 100万回/月 | $0 |
| **小計** | | | | **$0** |

### 9. Amazon ECR

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| ストレージ | Dockerイメージ | 500MB | 無料枠: 500MB/月 | $0 |
| **小計** | | | | **$0** |

### 10. Amazon CloudWatch

| 項目 | 詳細 | 月間使用量 | 単価 | 月間費用 |
|------|------|-----------|------|---------|
| ログ保存 | アプリケーションログ | 100MB | 無料枠: 5GB/月 | $0 |
| カスタムメトリクス | 監視メトリクス | 10個 | 無料枠: 10個/月 | $0 |
| **小計** | | | | **$0** |

## 月間費用サマリー

| サービス | 月間費用（USD） | 月間費用（円） | 全体に占める割合 |
|---------|---------------|---------------|----------------|
| **Amazon Bedrock** | **$4.20** | **630円** | **98.1%** |
| AgentCore Runtime | $0.08 | 12円 | 1.9% |
| Amplify | $0.00 | 0円 | 0% |
| DynamoDB | $0.00 | 0円 | 0% |
| S3 | $0.00 | 0円 | 0% |
| CloudFront | $0.00 | 0円 | 0% |
| API Gateway | $0.00 | 0円 | 0% |
| Lambda | $0.00 | 0円 | 0% |
| ECR | $0.00 | 0円 | 0% |
| CloudWatch | $0.00 | 0円 | 0% |

### **合計月間費用: $4.28 (約642円)**

## 利用量別費用シミュレーション

### 軽量利用（月30回）

| サービス | 月間費用 |
|---------|---------|
| Bedrock | $1.26 (189円) |
| AgentCore | $0.02 (3円) |
| **合計** | **$1.28 (192円)** |

### 標準利用（月100回）

| サービス | 月間費用 |
|---------|---------|
| Bedrock | $4.20 (630円) |
| AgentCore | $0.08 (12円) |
| **合計** | **$4.28 (642円)** |

### 重量利用（月300回）

| サービス | 月間費用 |
|---------|---------|
| Bedrock | $12.60 (1,890円) |
| AgentCore | $0.25 (38円) |
| **合計** | **$12.85 (1,928円)** |

## コスト最適化戦略

### 1. Bedrockコスト削減

**現在の構成**
- Claude 3 Sonnet: $3.00/1M入力トークン、$15.00/1M出力トークン

**最適化案**
- **Claude 3 Haiku併用**: $0.25/1M入力トークン、$1.25/1M出力トークン
- **プロンプト最適化**: トークン数20-30%削減
- **キャッシュ機能**: 類似質問の再利用

**効果**: 最大70%のコスト削減（$4.20 → $1.26）

### 2. AgentCore Runtime最適化

**現在の構成**
- コールドスタート: 30秒〜2分
- ウォームスタート: 数秒

**最適化案**
- **セッション再利用**: ウォームスタート活用
- **バッチ処理**: 複数質問の一括処理
- **実行時間短縮**: 並列処理の最適化

**効果**: 実行時間50%削減（$0.08 → $0.04）

### 3. 無料枠最大活用

**現状**
- 9/10サービスで無料枠内運用

**維持方法**
- CloudWatch Billing Alertsの設定
- 月間利用量の定期監視
- 使用量ダッシュボードの構築

## 年間費用予測

### 標準利用（月100回）の場合

| 期間 | 費用 |
|------|------|
| 月間 | $4.28 (642円) |
| 年間 | $51.36 (7,704円) |

### 成長シナリオ

| 月 | 利用回数 | 月間費用 | 累計費用 |
|----|---------|---------|---------|
| 1-3月 | 30回 | $1.28 | $3.84 |
| 4-6月 | 100回 | $4.28 | $16.68 |
| 7-9月 | 200回 | $8.56 | $42.36 |
| 10-12月 | 300回 | $12.85 | $80.91 |
| **年間合計** | | | **$80.91 (12,137円)** |

## リスク要因と対策

### 1. Bedrockトークン使用量の急増

**リスク**
- 長い質問や複雑な分析でトークン数増加
- 予想の2-3倍のコストになる可能性

**対策**
- トークン使用量の監視アラート設定
- 質問文字数制限の実装
- プロンプトエンジニアリングによる効率化

### 2. 利用量の予想外の増加

**リスク**
- 想定以上のユーザー利用
- 無料枠を超過する可能性

**対策**
- 利用量制限の実装
- 段階的な料金プランの検討
- スケーリング戦略の事前準備

### 3. AWS料金体系の変更

**リスク**
- Bedrock料金の値上げ
- 新サービスの料金発生

**対策**
- 定期的な料金体系の確認
- 代替サービスの調査
- コスト上限の設定

## 結論

### 主要ポイント

1. **非常に安価**: 月額642円で高度なAI分析システムを運用可能
2. **主要コスト**: Amazon Bedrock（98%）に集中
3. **スケーラブル**: 利用量に比例した従量課金
4. **最適化余地**: プロンプト改善で大幅なコスト削減可能

### 推奨事項

1. **段階的導入**: 軽量利用から開始し、需要に応じて拡大
2. **監視体制**: CloudWatch Billing Alertsで予算管理
3. **継続改善**: プロンプトエンジニアリングでコスト効率化
4. **代替案検討**: Claude 3 Haikuの部分的活用

### 投資対効果

**従来の開発コスト**
- 独自AI開発: 数百万円〜数千万円
- 開発期間: 6ヶ月〜2年

**MAGIシステム**
- 初期費用: ほぼゼロ
- 月間運用費: 642円
- 開発期間: 1-2ヶ月

**ROI**: 圧倒的にコスト効率が良い

---

*最終更新: 2025年10月28日*
*為替レート: 1USD = 150円で計算*