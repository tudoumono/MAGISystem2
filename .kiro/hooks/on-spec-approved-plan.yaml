name: "Sync Tasks on Spec Approval"
description: "Specæ‰¿èªæ™‚ã«tasksã¨ãƒ‡ãƒ¼ã‚¿å¥‘ç´„ã‚’åŒæœŸï¼ˆå­¦ç¿’ç”¨ï¼‰"

# ãƒˆãƒªã‚¬ãƒ¼è¨­å®š
triggers:
  - type: "spec_approved"
    spec_types: ["requirements", "design", "tasks"]
  - type: "file_save"
    patterns:
      - ".kiro/specs/**/requirements.md"
      - ".kiro/specs/**/design.md"
      - ".kiro/specs/**/tasks.md"

# å®Ÿè¡Œæ¡ä»¶
conditions:
  - type: "spec_status"
    status: "approved"
  - type: "file_contains"
    patterns:
      - "# Requirements Document"
      - "# Design Document" 
      - "# Implementation Plan"

# å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
steps:
  - name: "Extract API Contracts"
    commands:
      - "node scripts/extract-api-contracts.js {spec_path}"
    description: "Specã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã‚’æŠ½å‡º"
    outputs:
      - "src/types/generated/"
      - "agents/shared/types.py"

  - name: "Update Type Definitions"
    commands:
      - "npx amplify codegen"
      - "npm run type-check"
    description: "Amplifyå‹å®šç¾©ã‚’æ›´æ–°ã—ã€å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ"

  - name: "Sync Agent Configurations"
    condition: "spec_name.includes('agent')"
    commands:
      - "python scripts/sync-agent-configs.py {spec_path}"
    description: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šã‚’Specã¨åŒæœŸ"

  - name: "Generate Implementation Stubs"
    commands:
      - "node scripts/generate-stubs.js {spec_path}"
    description: "å®Ÿè£…ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ"
    outputs:
      - "src/components/generated/"
      - "src/lib/generated/"

  - name: "Update Documentation"
    commands:
      - "node scripts/update-docs.js {spec_path}"
    description: "æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•æ›´æ–°"
    outputs:
      - "docs/api/"
      - "docs/architecture/"

# å­¦ç¿’ç”¨æ©Ÿèƒ½
learning_features:
  show_diff: true
  explain_changes: true
  generate_comments: true
  create_learning_notes: true

# å‡ºåŠ›è¨­å®š
outputs:
  - path: "docs/learning/spec-sync-{timestamp}.md"
    content: "SpecåŒæœŸã®å­¦ç¿’ãƒ­ã‚°"
    template: "spec-sync-log"

# é€šçŸ¥è¨­å®š
notifications:
  on_success:
    message: "ğŸ“‹ SpecåŒæœŸå®Œäº†: {spec_name}"
    details: "å‹å®šç¾©ã€è¨­å®šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸ"
  on_error:
    message: "âš ï¸ SpecåŒæœŸã‚¨ãƒ©ãƒ¼: {error_message}"
    action: "æ‰‹å‹•ç¢ºèªãŒå¿…è¦ã§ã™"