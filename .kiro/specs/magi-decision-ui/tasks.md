# 実装計画

## 開発アプローチ: フロントエンドファースト

### 🎯 **段階的開発戦略**
**Phase 1-2**: モックデータでUI完成 → **Phase 3**: 部分統合 → **Phase 4-6**: 完全統合

### 📊 **各Phaseの動作レベル**
- **Phase 1-2**: 完全モック（視覚的に完璧、学習効果最大）
- **Phase 3**: 認証・データは実データ、エージェントはモック
- **Phase 4-6**: 全て実データ（本格的MAGIシステム）

### 🎓 **学習メリット**
- 視覚的フィードバックでモチベーション維持
- 段階的複雑性で自然な学習曲線
- エラーが分かりやすく、デバッグが容易

---

## Phase 1: 基盤とモックデータ実装

- [x] 1. プロジェクト構造とコアインターフェースのセットアップ **[🤖 Kiro]**
  - Next.js 15 + TypeScript + Tailwind CSSプロジェクトを作成（学習用詳細コメント付き）
  - Amplify Gen2設定（認証、データ、関数）をセットアップ（各設定の説明コメント付き）
  - エージェント、会話、トレース用のコアTypeScriptインターフェースを定義（型設計の理由を説明）
  - ESLint、Prettier、開発ツールを設定（設定理由と最適化ポイントを記載）
  - 学習用README.mdを作成（技術スタックの選択理由と学習ポイントを記載）
  - **モックデータライブラリの基盤を構築（様々なシナリオ対応）**
  - **📚 学習資料: 基礎技術の学習ドキュメント作成完了**
  - _要件: 1.1, 1.2, 1.3_

- [ ] 2. データモデルとAmplify Data設定の作成
  - [x] 2.1 Amplify Dataスキーマの定義 **[🤖 Kiro]**
    - User、Conversation、Message、TraceStep、AgentPresetモデルを作成
    - オーナーベースアクセスで認可ルールを設定
    - リアルタイム更新用GraphQLサブスクリプションをセットアップ
    - **🤖 AI可読性**: 各モデルの設計理由と関係性を詳細コメント化
    - _要件: 2.1, 2.2, 2.3_

  - [ ] 2.2 TypeScript型とAPIクライアントの生成 **[🤖 Kiro + 👤 Human]**





    - **[🤖 Kiro]** Amplify codegenを実行してスキーマから型を生成
    - **[🤖 Kiro]** データ操作用カスタムフック（useConversations、useMessages）を作成
    - **[🤖 Kiro]** より良いUXのための楽観的更新を実装
    - **[🤖 Kiro]** **🤖 AI可読性**: 各フックの使用目的と実装パターンを詳細解説
    - **[👤 Human]** `amplify push` でAWSリソースを実際にデプロイ
    - _要件: 2.1, 2.2, 2.3_

- [ ] 3. エージェントゲートウェイとStrands Agents統合
  - [ ] 3.1 Strands Agents基本セットアップ **[🤖 Kiro]**
    - 3賢者（CASPAR、BALTHASAR、MELCHIOR）エージェントを作成
    - SOLOMON Judgeエージェントを実装
    - A2A（Agent-to-Agent）プロトコルでの通信を設定
    - _要件: 3.1, 3.2_

  - [ ] 3.2 Amazon Bedrock AgentCore統合 **[👤 Human + 🤖 Kiro]**
    - **[👤 Human]** AWS ConsoleでBedrock モデルアクセス権限を有効化
    - **[👤 Human]** AgentCore Runtimeでの実行環境を構築（利用可能な場合）
    - **[🤖 Kiro]** OpenTelemetryトレーシングを有効化
    - **[🤖 Kiro]** CloudWatch + AWS X-Rayとの連携を設定
    - _要件: 4.5, 4.6_

  - [ ] 3.3 カスタムAmplifyハンドラーの構築 **[🤖 Kiro]**
    - Bedrock統合用カスタムビジネスロジックハンドラーを作成（Bedrock APIの使用方法を詳細説明）
    - エージェントオーケストレーションと応答集約を実装（Strands Agentsとの連携方法を解説）
    - トレースID生成と相関を追加（OpenTelemetryとの統合パターンを説明）
    - AgentCoreとの統合ポイントを学習用コメントで詳細説明
    - _要件: 3.1, 3.2, 3.3, 4.5_

- [ ] 4. 認証システムの実装
  - [ ] 4.1 Amplify Auth（Cognito）設定の作成 **[🤖 Kiro + 👤 Human]**
    - **[🤖 Kiro]** メール/パスワード認証でユーザープールを設定（Cognitoの仕組みを詳細コメント）
    - **[🤖 Kiro]** OAuthプロバイダーとMFAオプションをセットアップ（セキュリティ考慮点を説明）
    - **[🤖 Kiro]** ユーザー属性と検証設定を定義（各属性の用途と設計判断を記載）
    - **[🤖 Kiro]** Amplify Gen2のauth設定ファイルに学習用コメントを追加
    - **[👤 Human]** `amplify push` でCognitoリソースをAWSにデプロイ
    - _要件: 1.1, 1.2_

  - [ ] 4.2 SSRセッション管理の実装 **[🤖 Kiro]**
    - リクエストCookieからのトークン検証用サーバーアクションを作成
    - セッション永続化と自動更新を実装
    - 適切なクリーンアップ付きサインアウト機能を追加
    - _要件: 1.2, 1.3, 1.4_

---

## 📚 Phase 1-2 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント更新**: Phase 1-2完了時
  - `docs/learning/phases/phase1-2/frontend-first.md` 新規作成
  - `docs/learning/phases/phase1-2/ui-components.md` 新規作成  
  - `docs/learning/phases/phase1-2/mock-integration.md` 新規作成
  - 基礎技術ドキュメントにPhase 1-2実装例を追記
  - 相互参照リンクと学習順序の更新
  - 実装例とサンプルコードの追加
  - _学習戦略: フロントエンドファースト開発の完全ドキュメント化_

---

## Phase 2: フロントエンド基盤（認証とデザインシステム）

- [ ] 5. 認証UIとデザインシステムの構築
  - [ ] 5.1 認証UIコンポーネントの構築 **[🤖 Kiro]**
    - SignInForm、SignUpForm、ForgotPasswordFormコンポーネントを作成
    - SSRトークン処理付きAuthProviderコンテキストを実装
    - 保護されたルートラッパーと認証ガードを構築
    - **🤖 AI可読性**: 各コンポーネントの責務と認証フローを詳細解説
    - _要件: 1.1, 1.2, 1.3_

  - [ ] 5.2 基本UIコンポーネントライブラリの作成 **[🤖 Kiro]**
    - Button、Input、Card、Modal等の基本コンポーネントを作成
    - Tailwind CSSベースのデザインシステムを構築
    - ダークモード対応とテーマシステムを実装
    - **🤖 AI可読性**: デザインシステムの設計原則と各コンポーネントの使用指針を明記
    - _要件: 6.1, 6.2, 6.5_

---

## 📚 Phase 3 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント更新**: Phase 3完了時
  - `docs/learning/phases/phase3/README.md` 新規作成
  - `docs/learning/phases/phase3/data-integration.md` 新規作成
  - `docs/learning/phases/phase3/auth-implementation.md` 新規作成
  - `docs/learning/phases/phase3/realtime-features.md` 新規作成
  - AWS Amplify Gen2ドキュメントに実際の統合例を追記
  - Next.js App Routerドキュメントに認証統合パターンを追記
  - モックから実データへの移行パターンをドキュメント化
  - _学習戦略: 部分統合パターンの詳細解説_

---

## Phase 3: コア機能実装（エージェント連携）

- [ ] 6. エージェント設定とプリセットシステムの実装
  - [ ] 6.1 エージェント設定コンポーネントの作成 **[🤖 Kiro]**
    - 個別エージェント設定用AgentConfigPanelを構築
    - モデル選択、プロンプト編集、パラメータ調整を実装
    - プリセット管理インターフェース（作成、編集、削除、複製）を作成
    - _要件: 7.1, 7.2, 7.3_

  - [ ] 6.2 デフォルト設定付きプリセットシステムの実装 **[🤖 Kiro]**
    - デフォルトプリセット（デフォルト、学術研究用、ビジネス分析用）を作成
    - プリセット選択ドロップダウンとプレビュー機能を構築
    - プリセットインポート/エクスポート機能を実装
    - _要件: 7.2, 7.3, 7.4_

- [ ] 7. エージェント応答インターフェースの構築（モックデータ使用）
  - [ ] 7.1 エージェント応答パネルの作成（従来機能 + MAGI判断）
    - 3賢者それぞれのAgentResponsePanelを構築（従来機能）
    - 詳細な回答内容の表示（従来機能）
    - 応答比較とサイドバイサイドビューを追加（従来機能）
    - 可決/否決判断を視覚的に強調表示（色分け、アイコン）（新機能）
    - 判断理由と根拠の詳細表示機能を実装（新機能）
    - スケルトンコンポーネント付きローディング状態を実装
    - **モックデータで様々なシナリオ（全員一致、意見分裂、エラー）をテスト**
    - _要件: 3.1, 3.2, 5.3_

  - [ ] 7.2 SOLOMON Judge統合の実装
    - スコア可視化付きJudgeResponsePanelを作成
    - Rechartsを使用したスコア比較チャートを構築
    - 信頼度指標付き最終推奨表示を追加
    - _要件: 3.3, 3.4_

## Phase 4: 会話管理とトレーシング

- [ ] 8. 会話管理インターフェースの構築
  - [ ] 8.1 会話サイドバーコンポーネントの作成 **[🤖 Kiro]**
    - 無限スクロール付きConversationSidebarを実装
    - デバウンス入力付き検索機能を追加
    - 会話作成・削除機能を作成
    - _要件: 2.1, 2.2, 2.4, 2.5_

  - [ ] 8.2 会話ビューとメッセージ表示の実装 **[🤖 Kiro]**
    - メッセージ履歴付きChatInterfaceコンポーネントを構築
    - ユーザーとアシスタント用MessageBubbleコンポーネントを作成
    - 会話タイトル編集とメタデータ表示を追加
    - _要件: 2.3, 2.6_

- [ ] 9. 推論トレース可視化の実装
  - [ ] 9.1 トレースステップコンポーネントの作成
    - 展開可能詳細付きTraceStepItemを構築
    - ツール使用と引用表示を実装
    - 実行時間とエラー回数の可視化を追加
    - _要件: 4.1, 4.2, 4.3, 4.6_

  - [ ] 9.2 リアルタイムトレース更新の構築
    - ライブトレース更新用WebSocket接続を実装
    - 到着時の段階的トレースステップレンダリングを作成
    - トレース完了状態と進行状況インジケーターを追加
    - _要件: 4.1, 4.2, 4.6_

## Phase 5: 高度な機能と最適化

- [ ] 10. 動的機能とエラーハンドリング
  - [ ] 10.1 動的設定切り替えの追加
    - 会話途中での設定変更を実装
    - 設定変更通知と確認を作成
    - 設定比較と差分可視化を追加
    - _要件: 7.5, 7.6_

  - [ ] 10.2 再実行と比較機能の追加
    - 結果比較付き「再質問」機能を実装
    - 応答履歴とバージョン比較を作成
    - 応答評価とフィードバック収集を追加
    - _要件: 3.5, 7.6_

  - [ ] 10.3 エラーハンドリングとフォールバック機構の追加
    - 包括的エラーバウンダリシステムを実装
    - ユーザーフレンドリーなエラーメッセージと回復オプションを作成
    - オフラインサポートとリクエストキューイングを追加
    - _要件: 5.5_

- [ ] 11. パフォーマンス最適化の実装
  - [ ] 11.1 コード分割と遅延読み込みの追加
    - Next.jsでルートベースコード分割を実装
    - 重いコンポーネントのコンポーネント遅延読み込みを追加
    - 動的インポートでバンドルサイズを最適化
    - _要件: 5.1, 5.2_

  - [ ] 11.2 キャッシュと最適化戦略の実装
    - APIレスポンスキャッシュ用React Queryを追加
    - 会話リスト用仮想スクロールを実装
    - 画像最適化とアセット圧縮を追加
    - _要件: 5.1, 5.4_

---

## 📚 Phase 4-6 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント最終更新**: Phase 4-6完了時
  - `docs/learning/phases/phase4-6/README.md` 新規作成
  - `docs/learning/phases/phase4-6/ai-integration.md` 新規作成
  - `docs/learning/phases/phase4-6/observability.md` 新規作成
  - `docs/learning/phases/phase4-6/production-ready.md` 新規作成
  - 全基礎技術ドキュメントに本格運用の考慮事項を追記
  - 完全統合パターンとベストプラクティスをドキュメント化
  - 学習ガイドの完成版リリース準備
  - _学習戦略: 本格的AIシステム構築の完全ガイド_

---

## Phase 6: アクセシビリティとテスト

- [ ] 12. アクセシビリティと国際化の追加
  - [ ] 12.1 WCAG 2.1 AA準拠の実装
    - 適切なARIAラベルとセマンティックHTMLを追加
    - 全コンポーネントのキーボードナビゲーションを実装
    - スクリーンリーダーサポートとアナウンスを追加
    - _要件: 6.1, 6.2_

  - [ ] 12.2 国際化フレームワークのセットアップ
    - 日本語ローカライゼーション用next-i18nextを設定
    - 翻訳ファイルとロケール切り替えを作成
    - 将来の拡張用RTLサポート基盤を実装
    - _要件: 6.3, 6.4_

- [ ] 13. テストとパフォーマンス監視
  - [ ]* 13.1 データ操作の単体テスト作成 **[🤖 Kiro]**
    - 全モデルのCRUD操作をテスト
    - 認可ルールとアクセス制御を検証
    - リアルタイムサブスクリプション機能をテスト
    - _要件: 2.1, 2.2, 2.3_

  - [ ]* 13.2 統合テストの作成 **[🤖 Kiro]**
    - Playwrightで完全な認証フローをテスト
    - 会話作成とエージェント相互作用を検証
    - リアルタイム更新とトレース可視化をテスト
    - _要件: 全要件_

  - [ ] 13.3 パフォーマンス監視の追加 **[🤖 Kiro + 👤 Human]**
    - **[🤖 Kiro]** Core Web Vitalsトラッキングを実装
    - **[🤖 Kiro]** カスタムパフォーマンスメトリクスとログを追加
    - **[👤 Human]** CloudWatchでパフォーマンスダッシュボードとアラートを作成
    - _要件: 5.1, 5.2_

- [ ] 2. SSR対応認証システムの実装
  - [ ] 2.1 Amplify Auth（Cognito）設定の作成
    - メール/パスワード認証でユーザープールを設定（Cognitoの仕組みを詳細コメント）
    - OAuthプロバイダーとMFAオプションをセットアップ（セキュリティ考慮点を説明）
    - ユーザー属性と検証設定を定義（各属性の用途と設計判断を記載）
    - Amplify Gen2のauth設定ファイルに学習用コメントを追加
    - _要件: 1.1, 1.2_

  - [ ] 2.2 認証UIコンポーネントの構築
    - SignInForm、SignUpForm、ForgotPasswordFormコンポーネントを作成
    - SSRトークン処理付きAuthProviderコンテキストを実装
    - 保護されたルートラッパーと認証ガードを構築
    - _要件: 1.1, 1.2, 1.3_

  - [ ] 2.3 SSRセッション管理の実装
    - リクエストCookieからのトークン検証用サーバーアクションを作成
    - セッション永続化と自動更新を実装
    - 適切なクリーンアップ付きサインアウト機能を追加
    - _要件: 1.2, 1.3, 1.4_

- [ ] 3. データモデルとAmplify Data設定の作成
  - [ ] 3.1 Amplify Dataスキーマの定義
    - User、Conversation、Message、TraceStep、AgentPresetモデルを作成
    - オーナーベースアクセスで認可ルールを設定
    - リアルタイム更新用GraphQLサブスクリプションをセットアップ
    - _要件: 2.1, 2.2, 2.3_

  - [ ] 3.2 TypeScript型とAPIクライアントの生成
    - Amplify codegenを実行してスキーマから型を生成
    - データ操作用カスタムフック（useConversations、useMessages）を作成
    - より良いUXのための楽観的更新を実装
    - _要件: 2.1, 2.2, 2.3_

  - [ ]* 3.3 データ操作の単体テスト作成
    - 全モデルのCRUD操作をテスト
    - 認可ルールとアクセス制御を検証
    - リアルタイムサブスクリプション機能をテスト
    - _要件: 2.1, 2.2, 2.3_

- [ ] 4. 会話管理インターフェースの構築
  - [ ] 4.1 会話サイドバーコンポーネントの作成
    - 無限スクロール付きConversationSidebarを実装
    - デバウンス入力付き検索機能を追加
    - 会話作成・削除機能を作成
    - _要件: 2.1, 2.2, 2.4, 2.5_

  - [ ] 4.2 会話ビューとメッセージ表示の実装
    - メッセージ履歴付きChatInterfaceコンポーネントを構築
    - ユーザーとアシスタント用MessageBubbleコンポーネントを作成
    - 会話タイトル編集とメタデータ表示を追加
    - _要件: 2.3, 2.6_

  - [ ]* 4.3 会話管理テストの追加
    - 会話CRUD操作をテスト
    - 検索機能とページネーションを検証
    - メッセージ表示とリアルタイム更新をテスト
    - _要件: 2.1, 2.2, 2.3_

- [ ] 5. エージェント設定とプリセットシステムの実装
  - [ ] 5.1 エージェント設定コンポーネントの作成
    - 個別エージェント設定用AgentConfigPanelを構築
    - モデル選択、プロンプト編集、パラメータ調整を実装
    - プリセット管理インターフェース（作成、編集、削除、複製）を作成
    - _要件: 7.1, 7.2, 7.3_

  - [ ] 5.2 デフォルト設定付きプリセットシステムの実装
    - デフォルトプリセット（デフォルト、学術研究用、ビジネス分析用）を作成
    - プリセット選択ドロップダウンとプレビュー機能を構築
    - プリセットインポート/エクスポート機能を実装
    - _要件: 7.2, 7.3, 7.4_

  - [ ] 5.3 動的設定切り替えの追加
    - 会話途中での設定変更を実装
    - 設定変更通知と確認を作成
    - 設定比較と差分可視化を追加
    - _要件: 7.5, 7.6_

- [ ] 6. エージェント応答インターフェースの構築
  - [ ] 6.1 エージェント応答パネルの作成
    - 3賢者それぞれのAgentResponsePanelを構築
    - スケルトンコンポーネント付きローディング状態を実装
    - 応答比較とサイドバイサイドビューを追加
    - _要件: 3.1, 3.2, 5.3_

  - [ ] 6.2 SOLOMON Judge統合の実装（従来機能 + MAGI投票）
    - スコア可視化付きJudgeResponsePanelを作成（従来機能）
    - Rechartsを使用したスコア比較チャートを構築（従来機能）
    - 信頼度指標付き最終推奨表示を追加（従来機能）
    - MAGI投票結果の集計表示（可決X票、否決Y票）を実装（新機能）
    - SOLOMONの最終判断表示（可決/否決 + 根拠）を構築（新機能）
    - エヴァンゲリオン風のMAGIシステムUIデザインを適用（新機能）
    - _要件: 3.3, 3.4_

  - [ ] 6.3 再実行と比較機能の追加
    - 結果比較付き「再質問」機能を実装
    - 応答履歴とバージョン比較を作成
    - 応答評価とフィードバック収集を追加
    - _要件: 3.5, 7.6_

- [ ] 7. 推論トレース可視化の実装
  - [ ] 7.1 トレースステップコンポーネントの作成
    - 展開可能詳細付きTraceStepItemを構築
    - ツール使用と引用表示を実装
    - 実行時間とエラー回数の可視化を追加
    - _要件: 4.1, 4.2, 4.3, 4.6_

  - [ ] 7.2 リアルタイムトレース更新の構築
    - ライブトレース更新用WebSocket接続を実装
    - 到着時の段階的トレースステップレンダリングを作成
    - トレース完了状態と進行状況インジケーターを追加
    - _要件: 4.1, 4.2, 4.6_

  - [ ] 7.3 トレース相関とリンクの追加
    - トレースID表示と外部ログリンクを実装
    - トレースステップフィルタリングと検索機能を作成
    - トレースエクスポートと共有機能を追加
    - _要件: 4.4, 4.5_

- [ ] 8. API統合レイヤーの作成
  - [ ] 8.1 エージェントゲートウェイAPIクライアントの実装
    - 適切なエラーハンドリング付きaskAgent関数を作成
    - リクエスト/レスポンス型検証を実装
    - リトライロジックとタイムアウト処理を追加
    - _要件: 3.1, 3.2, 3.3_

  - [ ] 8.2 カスタムAmplifyハンドラーの構築
    - Bedrock統合用カスタムビジネスロジックハンドラーを作成（Bedrock APIの使用方法を詳細説明）
    - エージェントオーケストレーションと応答集約を実装（Strands Agentsとの連携方法を解説）
    - トレースID生成と相関を追加（OpenTelemetryとの統合パターンを説明）
    - AgentCoreとの統合ポイントを学習用コメントで詳細説明
    - _要件: 3.1, 3.2, 3.3, 4.5_

  - [ ] 8.3 エラーハンドリングとフォールバック機構の追加
    - 包括的エラーバウンダリシステムを実装
    - ユーザーフレンドリーなエラーメッセージと回復オプションを作成
    - オフラインサポートとリクエストキューイングを追加
    - _要件: 5.5_

- [ ] 9. パフォーマンス最適化の実装
  - [ ] 9.1 コード分割と遅延読み込みの追加
    - Next.jsでルートベースコード分割を実装
    - 重いコンポーネントのコンポーネント遅延読み込みを追加
    - 動的インポートでバンドルサイズを最適化
    - _要件: 5.1, 5.2_

  - [ ] 9.2 キャッシュと最適化戦略の実装
    - APIレスポンスキャッシュ用React Queryを追加
    - 会話リスト用仮想スクロールを実装
    - 画像最適化とアセット圧縮を追加
    - _要件: 5.1, 5.4_

  - [ ] 9.3 パフォーマンス監視の追加
    - Core Web Vitalsトラッキングを実装
    - カスタムパフォーマンスメトリクスとログを追加
    - パフォーマンスダッシュボードとアラートを作成
    - _要件: 5.1, 5.2_

- [ ] 10. アクセシビリティと国際化の追加
  - [ ] 10.1 WCAG 2.1 AA準拠の実装
    - 適切なARIAラベルとセマンティックHTMLを追加
    - 全コンポーネントのキーボードナビゲーションを実装
    - スクリーンリーダーサポートとアナウンスを追加
    - _要件: 6.1, 6.2_

  - [ ] 10.2 国際化フレームワークのセットアップ
    - 日本語ローカライゼーション用next-i18nextを設定
    - 翻訳ファイルとロケール切り替えを作成
    - 将来の拡張用RTLサポート基盤を実装
    - _要件: 6.3, 6.4_

  - [ ] 10.3 色アクセシビリティと視覚的インジケーターの追加
    - 色覚特性対応デザインパターンを実装
    - ステータスとアクション用の色以外の視覚的手がかりを追加
    - ハイコントラストモードサポートを作成
    - _要件: 6.5_

- [ ] 11. 統合テストとエンドツーエンドワークフロー
  - [ ]* 11.1 統合テストの作成
    - Playwrightで完全な認証フローをテスト
    - 会話作成とエージェント相互作用を検証
    - リアルタイム更新とトレース可視化をテスト
    - _要件: 全要件_

  - [ ]* 11.2 エンドツーエンドテストシナリオの追加
    - マルチエージェント会話ワークフローをテスト
    - 設定切り替えとプリセット管理を検証
    - エラーシナリオと回復機構をテスト
    - _要件: 全要件_

  - [ ] 11.3 パフォーマンスと負荷テスト
    - 負荷下でのアプリケーションパフォーマンスをテスト
    - リアルタイム更新のスケーラビリティを検証
    - 同時ユーザーシナリオをテスト
    - _要件: 5.1, 5.2, 5.4_