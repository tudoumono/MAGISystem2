# 実装計画

## 開発アプローチ: フロントエンドファースト

### 🎯 **段階的開発戦略**
**Phase 1-2**: モックデータでUI完成 → **Phase 3**: 部分統合 → **Phase 4-6**: 完全統合

### 📊 **各Phaseの動作レベル**
- **Phase 1-2**: 完全モック（視覚的に完璧、学習効果最大）
- **Phase 3**: 認証・データは実データ、エージェントはモック
- **Phase 4-6**: 全て実データ（本格的MAGIシステム）

### 🎓 **学習メリット**
- 視覚的フィードバックでモチベーション維持
- 段階的複雑性で自然な学習曲線
- エラーが分かりやすく、デバッグが容易

---

## 📋 AWS MCP参照タスク（継続的実施）

- [ ] **AWS MCP継続参照**: 各フェーズでの最新情報確認 **[🤖 Kiro]**
  - **Phase 1-2**: Amplify Gen2、Cognito、DynamoDB、AppSyncの最新機能と制限事項
  - **Phase 3**: Bedrock、AgentCore、Lambda統合の最新ベストプラクティス
  - **Phase 4-6**: CloudWatch、X-Ray、Route53の最新監視・運用機能
  - **権限管理**: 各フェーズで必要な最小権限の最新推奨事項
  - **セキュリティ**: 最新のセキュリティベストプラクティスとコンプライアンス要件
  - **コスト最適化**: 各サービスの最新料金体系と最適化手法
  - **手順書更新**: 新機能や変更に基づく手順書の継続的更新
  - _学習戦略: 常に最新のAWS情報に基づく実装と学習_

---

## Phase 1: 基盤とモックデータ実装

- [x] 1. プロジェクト構造とコアインターフェースのセットアップ **[🤖 Kiro]**
  - Next.js 15 + TypeScript + Tailwind CSSプロジェクトを作成（学習用詳細コメント付き）
  - Amplify Gen2設定（認証、データ、関数）をセットアップ（各設定の説明コメント付き）
  - エージェント、会話、トレース用のコアTypeScriptインターフェースを定義（型設計の理由を説明）
  - ESLint、Prettier、開発ツールを設定（設定理由と最適化ポイントを記載）
  - 学習用README.mdを作成（技術スタックの選択理由と学習ポイントを記載）
  - **モックデータライブラリの基盤を構築（様々なシナリオ対応）**
  - **📚 学習資料: 基礎技術の学習ドキュメント作成完了**
  - _要件: 1.1, 1.2, 1.3_

- [x] 2. データモデルとAmplify Data設定の作成
  - [x] 2.1 Amplify Dataスキーマの定義 **[🤖 Kiro]**
    - User、Conversation、Message、TraceStep、AgentPresetモデルを作成
    - オーナーベースアクセスで認可ルールを設定
    - リアルタイム更新用GraphQLサブスクリプションをセットアップ
    - **🤖 AI可読性**: 各モデルの設計理由と関係性を詳細コメント化
    - _要件: 2.1, 2.2, 2.3_

  - [x] 2.2 TypeScript型とAPIクライアントの生成 **[🤖 Kiro + 👤 Human]**





    - **[🤖 Kiro]** Amplify codegenを実行してスキーマから型を生成
    - **[🤖 Kiro]** データ操作用カスタムフック（useConversations、useMessages）を作成
    - **[🤖 Kiro]** より良いUXのための楽観的更新を実装
    - **[🤖 Kiro]** **🤖 AI可読性**: 各フックの使用目的と実装パターンを詳細解説
    - **[👤 Human]** `amplify push` でAWSリソースを実際にデプロイ
    - _要件: 2.1, 2.2, 2.3_

- [x] 3. エージェントゲートウェイとStrands Agents統合
  - [x] 3.1 Strands Agents基本セットアップ **[🤖 Kiro]**
    - 3賢者（CASPAR、BALTHASAR、MELCHIOR）エージェントを作成
    - SOLOMON Judgeエージェントを実装
    - A2A（Agent-to-Agent）プロトコルでの通信を設定
    - _要件: 3.1, 3.2_

  - [ ] 3.2 Amazon Bedrock AgentCore統合 **[👤 Human + 🤖 Kiro]**
    - **[🤖 Kiro]** **AWS MCP参照**: 最新のBedrock AgentCore権限とセットアップ手順を確認
    - **[👤 Human]** IAMユーザーに `AmazonBedrockFullAccess` と `BedrockAgentCoreFullAccess` 権限を追加
    - **[👤 Human]** AWS ConsoleでBedrock モデルアクセス権限を有効化
    - **[👤 Human]** AgentCore Runtimeでの実行環境を構築（利用可能な場合）
    - **[🤖 Kiro]** OpenTelemetryトレーシングを有効化
    - **[🤖 Kiro]** CloudWatch + AWS X-Rayとの連携を設定
    - _要件: 4.5, 4.6_

  - [ ] 3.3 カスタムAmplifyハンドラーの構築 **[🤖 Kiro]**
    - Bedrock統合用カスタムビジネスロジックハンドラーを作成（Bedrock APIの使用方法を詳細説明）
    - エージェントオーケストレーションと応答集約を実装（Strands Agentsとの連携方法を解説）
    - トレースID生成と相関を追加（OpenTelemetryとの統合パターンを説明）
    - AgentCoreとの統合ポイントを学習用コメントで詳細説明
    - _要件: 3.1, 3.2, 3.3, 4.5_

- [ ] 4. 基本UIコンポーネントライブラリの作成 **[🤖 Kiro]**
  - Button、Input、Card、Modal等の基本コンポーネントを作成
  - Tailwind CSSベースのデザインシステムを構築
  - ダークモード対応とテーマシステムを実装
  - **🤖 AI可読性**: デザインシステムの設計原則と各コンポーネントの使用指針を明記
  - _要件: 6.1, 6.2, 6.5_

- [ ] 5. モックデータライブラリの実装 **[🤖 Kiro]**
  - 様々なシナリオ（全員一致、意見分裂、エラー）のモックデータを作成
  - リアルな応答時間をシミュレートする機能を実装
  - エージェント応答とSOLOMON判断のモックデータを生成
  - トレースステップのモックデータを作成
  - **モックから実データへの移行を容易にする設計**
  - _要件: 3.1, 3.2, 3.3, 3.4_

---

## Phase 2: フロントエンド基盤（認証とデザインシステム）

- [ ] 6. 認証UIとデザインシステムの構築
  - [ ] 6.1 認証UIコンポーネントの構築 **[🤖 Kiro]**
    - SignInForm、SignUpForm、ForgotPasswordFormコンポーネントを作成
    - SSRトークン処理付きAuthProviderコンテキストを実装
    - 保護されたルートラッパーと認証ガードを構築
    - **🤖 AI可読性**: 各コンポーネントの責務と認証フローを詳細解説
    - _要件: 1.1, 1.2, 1.3_

  - [ ] 6.2 SSRセッション管理の実装 **[🤖 Kiro]**
    - リクエストCookieからのトークン検証用サーバーアクションを作成
    - セッション永続化と自動更新を実装
    - 適切なクリーンアップ付きサインアウト機能を追加
    - _要件: 1.2, 1.3, 1.4_

- [ ] 7. エージェント応答インターフェースの構築（モックデータ使用）
  - [ ] 7.1 エージェント応答パネルの作成（従来機能 + MAGI判断）
    - 3賢者それぞれのAgentResponsePanelを構築（従来機能）
    - 詳細な回答内容の表示（従来機能）
    - 応答比較とサイドバイサイドビューを追加（従来機能）
    - 可決/否決判断を視覚的に強調表示（色分け、アイコン）（新機能）
    - 判断理由と根拠の詳細表示機能を実装（新機能）
    - スケルトンコンポーネント付きローディング状態を実装
    - **モックデータで様々なシナリオ（全員一致、意見分裂、エラー）をテスト**
    - _要件: 3.1, 3.2, 5.3_

  - [ ] 7.2 SOLOMON Judge統合の実装
    - スコア可視化付きJudgeResponsePanelを作成
    - Rechartsを使用したスコア比較チャートを構築
    - 信頼度指標付き最終推奨表示を追加
    - MAGI投票結果の集計表示（可決X票、否決Y票）を実装（新機能）
    - SOLOMONの最終判断表示（可決/否決 + 根拠）を構築（新機能）
    - エヴァンゲリオン風のMAGIシステムUIデザインを適用（新機能）
    - _要件: 3.3, 3.4_

- [ ] 8. 会話管理インターフェースの構築
  - [ ] 8.1 会話サイドバーコンポーネントの作成 **[🤖 Kiro]**
    - 無限スクロール付きConversationSidebarを実装
    - デバウンス入力付き検索機能を追加
    - 会話作成・削除機能を作成
    - _要件: 2.1, 2.2, 2.4, 2.5_

  - [ ] 8.2 会話ビューとメッセージ表示の実装 **[🤖 Kiro]**
    - メッセージ履歴付きChatInterfaceコンポーネントを構築
    - ユーザーとアシスタント用MessageBubbleコンポーネントを作成
    - 会話タイトル編集とメタデータ表示を追加
    - _要件: 2.3, 2.6_

- [ ] 9. 推論トレース可視化の実装
  - [ ] 9.1 トレースステップコンポーネントの作成
    - 展開可能詳細付きTraceStepItemを構築
    - ツール使用と引用表示を実装
    - 実行時間とエラー回数の可視化を追加
    - _要件: 4.1, 4.2, 4.3, 4.6_

  - [ ] 9.2 リアルタイムトレース更新の構築
    - ライブトレース更新用WebSocket接続を実装
    - 到着時の段階的トレースステップレンダリングを作成
    - トレース完了状態と進行状況インジケーターを追加
    - _要件: 4.1, 4.2, 4.6_

---

## 📚 Phase 1-2 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント更新**: Phase 1-2完了時
  - `docs/learning/phases/phase1-2/frontend-first.md` 新規作成
  - `docs/learning/phases/phase1-2/ui-components.md` 新規作成  
  - `docs/learning/phases/phase1-2/mock-integration.md` 新規作成
  - 基礎技術ドキュメントにPhase 1-2実装例を追記
  - 相互参照リンクと学習順序の更新
  - 実装例とサンプルコードの追加
  - _学習戦略: フロントエンドファースト開発の完全ドキュメント化_

---

## Phase 3: コア機能実装（エージェント連携）

- [ ] 10. エージェント設定とプリセットシステムの実装
  - [ ] 10.1 エージェント設定コンポーネントの作成 **[🤖 Kiro]**
    - 個別エージェント設定用AgentConfigPanelを構築
    - モデル選択、プロンプト編集、パラメータ調整を実装
    - プリセット管理インターフェース（作成、編集、削除、複製）を作成
    - _要件: 7.1, 7.2, 7.3_

  - [ ] 10.2 デフォルト設定付きプリセットシステムの実装 **[🤖 Kiro]**
    - デフォルトプリセット（デフォルト、学術研究用、ビジネス分析用）を作成
    - プリセット選択ドロップダウンとプレビュー機能を構築
    - プリセットインポート/エクスポート機能を実装
    - _要件: 7.2, 7.3, 7.4_

- [ ] 11. 動的機能とエラーハンドリング
  - [ ] 11.1 動的設定切り替えの追加
    - 会話途中での設定変更を実装
    - 設定変更通知と確認を作成
    - 設定比較と差分可視化を追加
    - _要件: 7.5, 7.6_

  - [ ] 11.2 再実行と比較機能の追加
    - 結果比較付き「再質問」機能を実装
    - 応答履歴とバージョン比較を作成
    - 応答評価とフィードバック収集を追加
    - _要件: 3.5, 7.6_

  - [ ] 11.3 エラーハンドリングとフォールバック機構の追加
    - 包括的エラーバウンダリシステムを実装
    - ユーザーフレンドリーなエラーメッセージと回復オプションを作成
    - オフラインサポートとリクエストキューイングを追加
    - _要件: 5.5_

---

## 📚 Phase 3 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント更新**: Phase 3完了時
  - `docs/learning/phases/phase3/README.md` 新規作成
  - `docs/learning/phases/phase3/data-integration.md` 新規作成
  - `docs/learning/phases/phase3/auth-implementation.md` 新規作成
  - `docs/learning/phases/phase3/realtime-features.md` 新規作成
  - AWS Amplify Gen2ドキュメントに実際の統合例を追記
  - Next.js App Routerドキュメントに認証統合パターンを追記
  - モックから実データへの移行パターンをドキュメント化
  - _学習戦略: 部分統合パターンの詳細解説_

---

## Phase 4: パフォーマンス最適化と高度な機能

- [ ] 12. パフォーマンス最適化の実装
  - [ ] 12.1 コード分割と遅延読み込みの追加
    - Next.jsでルートベースコード分割を実装
    - 重いコンポーネントのコンポーネント遅延読み込みを追加
    - 動的インポートでバンドルサイズを最適化
    - _要件: 5.1, 5.2_

  - [ ] 12.2 キャッシュと最適化戦略の実装
    - APIレスポンスキャッシュ用React Queryを追加
    - 会話リスト用仮想スクロールを実装
    - 画像最適化とアセット圧縮を追加
    - _要件: 5.1, 5.4_

  - [ ] 12.3 パフォーマンス監視の追加 **[🤖 Kiro + 👤 Human]**
    - **[🤖 Kiro]** Core Web Vitalsトラッキングを実装
    - **[🤖 Kiro]** カスタムパフォーマンスメトリクスとログを追加
    - **[👤 Human]** CloudWatchでパフォーマンスダッシュボードとアラートを作成
    - _要件: 5.1, 5.2_

---

## Phase 5: アクセシビリティとテスト

- [ ] 13. アクセシビリティと国際化の追加
  - [ ] 13.1 WCAG 2.1 AA準拠の実装
    - 適切なARIAラベルとセマンティックHTMLを追加
    - 全コンポーネントのキーボードナビゲーションを実装
    - スクリーンリーダーサポートとアナウンスを追加
    - _要件: 6.1, 6.2_

  - [ ] 13.2 国際化フレームワークのセットアップ
    - 日本語ローカライゼーション用next-i18nextを設定
    - 翻訳ファイルとロケール切り替えを作成
    - 将来の拡張用RTLサポート基盤を実装
    - _要件: 6.3, 6.4_

- [ ] 14. テストとパフォーマンス監視
  - [ ]* 14.1 データ操作の単体テスト作成 **[🤖 Kiro]**
    - 全モデルのCRUD操作をテスト
    - 認可ルールとアクセス制御を検証
    - リアルタイムサブスクリプション機能をテスト
    - _要件: 2.1, 2.2, 2.3_

  - [ ]* 14.2 統合テストの作成 **[🤖 Kiro]**
    - Playwrightで完全な認証フローをテスト
    - 会話作成とエージェント相互作用を検証
    - リアルタイム更新とトレース可視化をテスト
    - _要件: 全要件_

---

## 📚 Phase 4-6 完了時の学習資料更新 **[🤖 Kiro]**
- [ ] **学習ドキュメント最終更新**: Phase 4-6完了時
  - **AWS MCP参照**: 最新のAWS機能とベストプラクティスを反映
  - `docs/learning/phases/phase4-6/README.md` 新規作成
  - `docs/learning/phases/phase4-6/ai-integration.md` 新規作成
  - `docs/learning/phases/phase4-6/observability.md` 新規作成
  - `docs/learning/phases/phase4-6/production-ready.md` 新規作成
  - 全基礎技術ドキュメントに本格運用の考慮事項を追記
  - 完全統合パターンとベストプラクティスをドキュメント化
  - 学習ガイドの完成版リリース準備
  - _学習戦略: 本格的AIシステム構築の完全ガイド_

## 📚 継続的ドキュメント更新タスク

- [ ] **手順書の継続的更新** **[🤖 Kiro]**
  - **AWS MCP定期参照**: 月次でAWS新機能・変更点をチェック
  - **権限要件の更新**: 新サービス・機能に応じた権限の見直し
    - Phase 1-2: `PowerUserAccess` + `AmplifyBackendDeployFullAccess`
    - Phase 3: `AmazonBedrockFullAccess` + `BedrockAgentCoreFullAccess` + `AWSLambdaFullAccess` 追加
    - Phase 4: `CloudWatchFullAccess` + `AmazonRoute53FullAccess`（オプション）追加
  - **セキュリティ要件の更新**: 最新のセキュリティベストプラクティス反映
  - **コスト最適化の更新**: 料金変更・新サービスに応じた最適化手法
  - **トラブルシューティングの拡充**: 実際の問題事例と解決方法の追加
  - **学習リソースの更新**: 新しい公式ドキュメント・チュートリアルの追加
  - _継続的改善: 常に最新で正確な手順書の維持_

### 🔍 AWS MCP参照ガイドライン

**手順書作成・更新時の必須チェック項目:**

1. **権限要件の確認**
   - `mcp_aws_knowledge_mcp_server_aws___search_documentation` で最新のIAMポリシーを検索
   - `mcp_aws_knowledge_mcp_server_aws___read_documentation` で公式ドキュメントの詳細を確認
   - 各サービスの最小権限要件と推奨設定を調査

2. **サービス制限・制約の確認**
   - 各AWSサービスのクォータ・制限事項を確認
   - リージョン別の機能可用性をチェック
   - 新機能のプレビュー・GA状況を確認

3. **セキュリティベストプラクティスの確認**
   - 最新のセキュリティ推奨事項を調査
   - コンプライアンス要件の変更をチェック
   - 暗号化・認証方式の最新動向を確認

4. **コスト最適化の確認**
   - 料金体系の変更・新プランを調査
   - 無料利用枠の条件変更をチェック
   - コスト削減の新手法を確認

5. **手順書の品質保証**
   - 実際のAWS環境での手順検証
   - エラーケース・トラブルシューティングの充実
   - 初心者向けの説明とコメントの追加